#!/usr/bin/bash

policy_file='/usr/share/polkit-1/actions/org.manjaro.TEST.policy'
new="$(pwd)/backend-test.py"

POLICY="$(cat <<'EOT'
<?xml version="1.0" encoding="UTF-8"?><!-- file in /usr/share/polkit-1/actions/ -->
<!DOCTYPE policyconfig PUBLIC "-//freedesktop//DTD PolicyKit Policy Configuration 1.0//EN" "http://www.freedesktop.org/standards/PolicyKit/1/policyconfig.dtd">
<policyconfig>
    <vendor>Manjaro</vendor><vendor_url>http://www.manjaro.org</vendor_url>
    <icon_name>gnome</icon_name>
    <action id="org.manjaro.backendtest.asadmin">
        <description>TEST Run backendtest as root</description>
        <message>TEST Admin is required to run backendtest</message>
        <defaults>
            <allow_any>no</allow_any><allow_inactive>auth_admin_keep</allow_inactive><allow_active>auth_admin_keep</allow_active>
        </defaults>
        <annotate key="org.freedesktop.policykit.exec.path">PATH</annotate>
        <annotate key="org.freedesktop.policykit.exec.allow_gui">true</annotate>
    </action>
</policyconfig>
EOT
)"
POLICY="${POLICY/PATH/$new}"
echo "run demo for dev"
#echo -e "$POLICY"

echo "$POLICY" | sudo tee -a "$policy_file"
#sudo echo "$POLICY" > "$policy_file"
#cat "$policy_file"
#sudo -k
$new
#echo "rm .policy"
sudo rm -v "$policy_file"
